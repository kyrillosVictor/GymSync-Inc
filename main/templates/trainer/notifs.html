{% extends "base.html" %} 
{% load static %} 
{% block content %}
<style type="text/css">
  .marked {
    display: none;
  }
</style>

<!-- Main Start -->
<main>
  <head>
    <title>GymSync - Trainer Dashboard/Notifications</title>
  </head>

  <section class="container my-4">
    <div class="row">
      <div class="col-3">
        {% include 'trainer/left_sidebar.html' %}</div>
      <div class="col-9">
        <h3 class="mb-4 border-bottom pb-1">
          <!-- show the count of the notifications -->
          Notifications <span class="badge bg-primary totalunread"> {{ notifs.count }}</span>
        </h3>
        <span type="ajax"> </span>
        <ul class="list-group notif-list table-bordered">
            {% for notif in notifs %}
          <li class="list-group-item">
            {{notif.notify_detail}}
            {% if not notifStatus %}
              <span class="btn btn-info btn-sm float-end"> Mark As Read</span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </section>
  <!-- End -->
</main>

<!-- Creating WebSocket to pair with Django channels for more stable and continous communication with the server-->
<script>
  const webSocket = new WebSocket(
    'ws://'
    + windows.location.host
    + '/ws/notifications'
  );

  webSocket.onopen = function(event) {
    webSocket.send(JSON, stringify({
      'message': "From client"
    }));
  }

  webSocket.onmessage = function(event) {
    var _data = JSON.parse(event.data);
    $(".notif-list").append('<li class="list-group-item">' + _data.notif + '<span class="btn btn-info btn-sm float-end"> Mark As Read</span> </li>')
    $('.totalunread').text(_data.total);
    
  }

  webSocket.onclose = function(event) {
    console.log('Closed');
  }
</script>

{% endblock %}
